P1=[0.95 0.05; 
    0.1 0.9];

P2=[0.8 0.2;
    0.6 0.4;
    0.2 0.8;
    0.2 0.8];

P3=[0.6 0.4;
    0.9 0.1;
    0.6 0.4;
    0.6 0.4;
    0.4 0.6;
    0.1 0.9;
    0.4 0.6;
    0.4 0.6];

s1=[1 0]';
s2=[1 0]';
s3=[1 0]';

N=200;

X=zeros(N,1);

for t=1:N
  p1=P1'*s1;
  s1=dsample(p1);

  p2=P2'*kron(s2,s1);
  s2=dsample(p2);
  
  p3=P3'*kron(s2,kron(s1,s2));
  s3=dsample(p3);

  X(t)=[5 -5]*s1+[2 -2]*s2+[0.5 -0.5]*s3+randn*0.1;
end;  
  
  
  